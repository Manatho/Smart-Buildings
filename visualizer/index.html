<!DOCTYPE html>
<html>

<head>
    <title>Page Title</title>
    <meta name="viewport" content="height=device-height, initial-scale=1.0">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.8.0/Chart.bundle.min.js"></script>
    <script src="public/modelCO2.js"></script>
    <script type="text/javascript" src="../public/livedata.json"></script>

</head>

<body style="font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif">
    <h1 id="top">Live</h1>
    <div style="background-color: rgb(230, 230, 230); width: 100%; height: 600px;  display: flex;">
        <div style=" width: 33%;">
            <canvas id="liveTempChart" width="1" height="1"></canvas>
        </div>
        <div style="width: 33%;">
            <canvas id="liveCo2Chart" width="1" height="1"></canvas>
        </div>
        <div style=" width: 33%;">
            <canvas id="livePeopleChart" width="1" height="1"></canvas>
        </div>
    </div>
    <h1>Last Simulation</h1>
    <div style="background-color: rgb(230, 230, 230); width: 100%; height: 600px;  display: flex;">
        <div id="data" style="width: 21%; height: 100%;"></div>
        <div style=" width: 26%;">
            <canvas id="tempChart" width="1" height="1"></canvas>
        </div>
        <div style="width: 26%;">
            <canvas id="co2Chart" width="1" height="1"></canvas>
        </div>
        <div style=" width: 26%;">
            <canvas id="consumptionChart" width="1" height="1"></canvas>
        </div>

    </div>
    <script>
        //LIVE DATA SECTION

        var data = {
            timestep: 3600, data: [
                { time: "00", temperature: 14, people: 3 },
                { time: "01", temperature: 14, people: 3 },
                { time: "02", temperature: 14, people: 3 },
                { time: "03", temperature: 14, people: 3 },
                { time: "04", temperature: 14, people: 3 },
                { time: "05", temperature: 14, people: 3 },
                { time: "06", temperature: 14, people: 3 },
                { time: "07", temperature: 14, people: 3 },
                { time: "08", temperature: 14, people: 3 },
                { time: "09", temperature: 14, people: 3 },
                { time: "10", temperature: 14, people: 3 },
                { time: "11", temperature: 14, people: 3 },
                { time: "12", temperature: 14, people: 3 },
                { time: "13", temperature: 14, people: 3 },
                { time: "14", temperature: 14, people: 3 },
                { time: "15", temperature: 14, people: 3 },
                { time: "16", temperature: 14, people: 3 },
                { time: "17", temperature: 14, people: 3 },
                { time: "18", temperature: 14, people: 3 },
                { time: "19", temperature: 14, people: 3 },
                { time: "20", temperature: 14, people: 3 },
                { time: "21", temperature: 14, people: 3 },
                { time: "22", temperature: 14, people: 3 },
                { time: "23", temperature: 14, people: 3 }]
        };

        let startTemp = 16;
        let roomsize = 50;
        let startCO2 = 49;
        let comfortRange = { lower: 19, higher: 23 };
        let emptyRange = { lower: 16, higher: 26 };

        let demandRange = { lower: 12, higher: 16 }
        let demandPower = 0.3;

        let co2Model = new TempPeopleCO2Model(startTemp, roomsize, startCO2, comfortRange, emptyRange);
        let result = co2Model.predict(data.timestep, data.data, demandRange, demandPower);
        co2Model.rails = result.stateSequence;
        console.log(result);


        let hourNumber = 0;
        let showData = [];
        data.data.forEach(o => {
            let prevConsumption = co2Model.consumption(data.timestep);
            co2Model.update(data.timestep, o.temperature, o.people);
            showData.push({ hour: o.time, consumption: prevConsumption, co2: co2Model.currentCO2, temperature: co2Model.currentTemperature })
        })

        let formattedData = `<h3>Model</h3>
        <div style="background-color: #efefef; white-space: nowrap; overflow-x: scroll; height: 30%; width:100%;">
        Temperature: <b>${startTemp}&#176;</b> &nbsp;&nbsp; Room: <b>${roomsize}m&#179;</b> &nbsp&nbsp CO2: <b>${startCO2}kg</b> &nbsp &nbsp<br>
        Comfort Range: <b>${comfortRange.lower}&#176</b> to <b>${comfortRange.higher}&#176</b> if empty:  <b>${emptyRange.lower}&#176</b> to <b>${emptyRange.higher}&#176</b><br>
        CO2 Range: <b>${co2Model.CO2Rangekg.lower}kg</b> to <b>${co2Model.CO2Rangekg.higher}kg</b> for a room size <b>${roomsize}m&#179;</b><br><br>
        DemandResponse: <b>${demandRange.lower}</b> to <b>${demandRange.higher}</b> with <b>${demandPower}</b>kW/h <br>
        Could fulfill: <b>${result.possible.toString().toUpperCase()}</b>
        </div> 
        <h2>Data</h2>
        <div style="background-color: #efefef; white-space: nowrap; font-size:px; overflow-y: scroll; height: 43%;">
        `;
        data.data.forEach(dp => {
            formattedData += `Time: <b>${dp.time}</b> &nbsp;&nbsp;&nbsp;&nbsp;  Temperature: <b>${dp.temperature}</b> &nbsp;&nbsp;&nbsp;&nbsp; People: <b>${dp.people}</b><br>`
        })
        formattedData += `</div>`
        document.getElementById("data").innerHTML = formattedData;

        renderChart('co2Chart', 'co2', 'rgba(255,0,0,0.3)', showData)
        renderChart('tempChart', 'temperature', 'rgba(0,255,0,0.3)', showData)
        renderChart('consumptionChart', 'consumption', 'rgba(0,0,255, 0.3)', showData)

        function renderChart(canvasId, field, color, data) {
            let ctx = document.getElementById(canvasId).getContext('2d');
            let labels = data.map(obj => obj.hour);
            let dataTemp = data.map(obj => obj[field]);
            let myChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        lineTension: 0,
                        label: field,
                        data: dataTemp,
                        backgroundColor: [
                            color
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    maintainAspectRatio: false,
                    scales: {
                        yAxes: [{
                            scaleLabel: {
                                display: true,
                                labelString: unitPicker(field)
                            },

                            ticks: {
                                beginAtZero: true
                            }
                        }],
                        xAxes: [{
                            scaleLabel: {
                                display: true,
                                labelString: "Time"
                            },
                        }]
                    }
                }
            });
        }

        function unitPicker(name) {
            switch (name) {
                case "co2":
                    return "kg";
                case "consumption":
                    return "kW"
                case "temperature":
                    return "Degrees Celsius"
            }
        }

    </script>
    <script src="public/livedata.js"></script>
</body>

</html>